# UserMetrics ì‹œìŠ¤í…œ ì „ì²´ ê°€ì´ë“œ

## ğŸ“Œ ëª©ì°¨
1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì•„í‚¤í…ì²˜](#ì•„í‚¤í…ì²˜)
3. [ë°ì´í„° ìˆ˜ì§‘ íë¦„](#ë°ì´í„°-ìˆ˜ì§‘-íë¦„)
4. [ì£¼ìš” ê¸°ëŠ¥](#ì£¼ìš”-ê¸°ëŠ¥)
5. [ì„¤ì¹˜ ë° ì„¤ì •](#ì„¤ì¹˜-ë°-ì„¤ì •)
6. [ì‚¬ìš© ë°©ë²•](#ì‚¬ìš©-ë°©ë²•)
7. [ì½”ë“œ ì„¤ëª…](#ì½”ë“œ-ì„¤ëª…)
8. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## ì‹œìŠ¤í…œ ê°œìš”

### ğŸ¯ ëª©ì 
UserMetrics ì‹œìŠ¤í…œì€ ì‚¬ìš©ì í–‰ë™ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ë¶„ì„í•˜ì—¬ **AI ê¸°ë°˜ ê°œì¸í™” ì¶”ì²œ**ì„ ì œê³µí•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### âœ¨ í•µì‹¬ ê¸°ëŠ¥
1. **RAG ê²€ìƒ‰ ê¸°ë¡** - ì‚¬ìš©ìê°€ ì±—ë´‡ì—ì„œ ë¬´ì—‡ì„ ê²€ìƒ‰í–ˆëŠ”ì§€ ì¶”ì 
2. **ë‘í”¼ ì§„ë‹¨ ê¸°ë¡** - ì§„ë‹¨ ê²°ê³¼, ì ìˆ˜, ë¯¼ê°ë„ ì €ì¥
3. **ì œí’ˆ í´ë¦­ ë¶„ì„** - ì–´ë–¤ ì œí’ˆì„ í´ë¦­í–ˆëŠ”ì§€, ì–´ë””ì„œ ì¶”ì²œë°›ì•˜ëŠ”ì§€ ê¸°ë¡
4. **ì¼€ì–´ ë¯¸ì…˜ ì™„ë£Œ** - ë°ì¼ë¦¬ ì¼€ì–´ ë¯¸ì…˜ ì™„ë£Œ ì´ë ¥ ë° ì—°ì† ì¼ìˆ˜ ì €ì¥
5. **ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ** - ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ì—¬ í†µê³„ ì œê³µ

### ğŸ”‘ ì™œ í•„ìš”í•œê°€?
- **AI ì¶”ì²œì˜ ì •í™•ë„**: ì‚¬ìš©ìê°€ ë¬´ì—‡ì— ê´€ì‹¬ ìˆëŠ”ì§€ ì•Œì•„ì•¼ ë§ì¶¤ ì¶”ì²œ ê°€ëŠ¥
- **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **: ê°œì¸í™”ëœ ì„œë¹„ìŠ¤ ì œê³µ
- **ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸**: ì¸ê¸° ê²€ìƒ‰ì–´, ì„ í˜¸ ì œí’ˆ íŒŒì•…

---

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚
â”‚  (React/TS)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ API í˜¸ì¶œ
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Spring Boot    â”‚
â”‚  Backend        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UserMetrics     â”‚
â”‚ Controller      â”‚ â† API ì—”ë“œí¬ì¸íŠ¸
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UserMetrics     â”‚
â”‚ Service         â”‚ â† ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UserMetrics     â”‚
â”‚ Repository      â”‚ â† JPA
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Database      â”‚
â”‚  (MySQL/H2)     â”‚
â”‚ user_metric í…Œì´ë¸”â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í…Œì´ë¸” êµ¬ì¡°: `user_metric`

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì„¤ëª… |
|--------|------|------|
| `user_metric_id` | BIGINT | ê¸°ë³¸í‚¤ (ìë™ ì¦ê°€) |
| `user_id_foreign` | BIGINT | ì‚¬ìš©ì ID (ì™¸ë˜í‚¤ â†’ users_info) |
| `type` | VARCHAR | ë©”íŠ¸ë¦­ íƒ€ì… (RAG_SEARCH, SCALP_DIAGNOSIS ë“±) |
| `value` | TEXT | JSON í˜•íƒœì˜ ë°ì´í„° (ì¿¼ë¦¬, ì ìˆ˜, ì œí’ˆëª… ë“±) |
| `record_date` | TIMESTAMP | ê¸°ë¡ ì‹œê°„ |

---

## ë°ì´í„° ìˆ˜ì§‘ íë¦„

### 1ï¸âƒ£ RAG ê²€ìƒ‰ ìˆ˜ì§‘
```
ì‚¬ìš©ìê°€ ì±—ë´‡ì— ì§ˆë¬¸ ì…ë ¥
    â†“
ChatBotMessenger.tsx - sendMessage()
    â†“
POST /api/metrics/rag-search
    {
      query: "íƒˆëª¨ ì¹˜ë£Œë²•",
      resultCount: 5,
      clicked: false,
      clickedTitle: ""
    }
    â†“
UserMetricsService.logRAGSearch()
    â†“
DB ì €ì¥ (type: RAG_SEARCH)
```

**ì½”ë“œ ìœ„ì¹˜**: `ChatBotMessenger.tsx:185-195`

### 2ï¸âƒ£ ë‘í”¼ ì§„ë‹¨ ìˆ˜ì§‘
```
ì‚¬ìš©ìê°€ ë‘í”¼ ì§„ë‹¨ ì™„ë£Œ
    â†“
IntegratedDiagnosis.tsx - startAnalysis()
    â†“
ë¶„ì„ ê²°ê³¼ ìƒì„± (analysisResult)
    â†“
POST /api/metrics/scalp-diagnosis
    {
      scalpType: "ë‚¨ì„±í˜• íƒˆëª¨",
      scalpScore: 3,
      sensitivity: "high"
    }
    â†“
UserMetricsService.logScalpDiagnosis()
    â†“
DB ì €ì¥ (type: SCALP_DIAGNOSIS)
```

**ì½”ë“œ ìœ„ì¹˜**: `IntegratedDiagnosis.tsx:230-242`

### 3ï¸âƒ£ ì œí’ˆ í´ë¦­ ìˆ˜ì§‘
```
ì‚¬ìš©ìê°€ ì œí’ˆ ì¹´ë“œ í´ë¦­
    â†“
ProductCard.tsx - handleProductClick()
    â†“
POST /api/metrics/product-click
    {
      productCategory: "íƒˆëª¨ìƒ´í‘¸",
      productName: "ë‹¥í„°í¬í—¤ì–´ ìƒ´í‘¸",
      recommendedBy: "ì§„ë‹¨ê²°ê³¼"
    }
    â†“
UserMetricsService.logProductClick()
    â†“
DB ì €ì¥ (type: PRODUCT_CLICK)
```

**ì½”ë“œ ìœ„ì¹˜**: `ProductCard.tsx:19-32`

### 4ï¸âƒ£ ì¼€ì–´ ë¯¸ì…˜ ìˆ˜ì§‘
```
ì‚¬ìš©ìê°€ ë°ì¼ë¦¬ ì¼€ì–´ ë¯¸ì…˜ ì™„ë£Œ
    â†“
DailyCare.tsx - handleMissionComplete()
    â†“
POST /api/metrics/care-mission
    {
      missionType: "ë¬¼ ë§ˆì‹œê¸°",
      streakCount: 5
    }
    â†“
UserMetricsService.logCareMissionComplete()
    â†“
DB ì €ì¥ (type: CARE_MISSION)
```

**ì½”ë“œ ìœ„ì¹˜**: `DailyCare.tsx:736-745`

---

## ì£¼ìš” ê¸°ëŠ¥

### ğŸ“Š ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ

ê´€ë¦¬ìëŠ” `/admin/dashboard`ì—ì„œ **UserMetrics** íƒ­ì„ í†µí•´ ë‹¤ìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

#### 1. ì¸ê¸° ê²€ìƒ‰ í‚¤ì›Œë“œ TOP 10
- ìµœê·¼ 7ì¼ê°„ ê°€ì¥ ë§ì´ ê²€ìƒ‰ëœ í‚¤ì›Œë“œ
- ê·¸ë¦¬ë“œ í˜•íƒœë¡œ ì‹œê°í™”
- API: `GET /api/admin/metrics/popular-searches?days=7`

#### 2. ì‹¤ì‹œê°„ í†µê³„
- **ì´ ê²€ìƒ‰ íšŸìˆ˜**: RAG ê²€ìƒ‰ ì´ ê°œìˆ˜
- **í™œì„± ì‚¬ìš©ì ìˆ˜**: ìµœê·¼ 7ì¼ ë™ì•ˆ í™œë™í•œ ì‚¬ìš©ì
- **ë‘í”¼ ì§„ë‹¨ íšŸìˆ˜**: ì´ ì§„ë‹¨ íšŸìˆ˜
- API: `GET /api/admin/metrics/overview`

**ìŠ¤í¬ë¦°ìƒ· ìœ„ì¹˜**: Admin Dashboard > UserMetrics íƒ­

---

## ì„¤ì¹˜ ë° ì„¤ì •

### ë°±ì—”ë“œ (Spring Boot)

#### 1. Entity í™•ì¸
```java
// UserMetricEntity.java
@Entity
@Table(name = "user_metric")
public class UserMetricEntity {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long userMetricId;

    @ManyToOne
    @JoinColumn(name = "user_id_foreign")
    private UserEntity userIdForeign;

    private String type;  // RAG_SEARCH, SCALP_DIAGNOSIS ë“±

    @Column(columnDefinition = "TEXT")
    private String value; // JSON ë°ì´í„°

    private Instant recordDate;
}
```

#### 2. Repository ìƒì„±ë¨
- `UserMetricsRepository.java` - JPA ì¿¼ë¦¬ ë©”ì„œë“œ

#### 3. Service êµ¬í˜„ë¨
- `UserMetricsService.java` - ì €ì¥ ë° ì¡°íšŒ ë¡œì§

#### 4. Controller êµ¬í˜„ë¨
- `UserMetricsController.java` - `/api/metrics/*` ì—”ë“œí¬ì¸íŠ¸
- `AdminController.java` - `/api/admin/metrics/*` ì—”ë“œí¬ì¸íŠ¸

### í”„ë¡ íŠ¸ì—”ë“œ (React/TypeScript)

#### 1. API í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
```typescript
import apiClient from '../../services/apiClient';

// ê²€ìƒ‰ ë©”íŠ¸ë¦­ ì €ì¥ ì˜ˆì‹œ
await apiClient.post('/api/metrics/rag-search', {
  query: "íƒˆëª¨ ì˜ˆë°©ë²•",
  resultCount: 3,
  clicked: false,
  clickedTitle: ""
});
```

#### 2. ê° í˜ì´ì§€ì— ì—°ë™ ì™„ë£Œ
- âœ… `ChatBotMessenger.tsx` - RAG ê²€ìƒ‰
- âœ… `IntegratedDiagnosis.tsx` - ë‘í”¼ ì§„ë‹¨
- âœ… `ProductCard.tsx` - ì œí’ˆ í´ë¦­
- âœ… `DailyCare.tsx` - ì¼€ì–´ ë¯¸ì…˜

---

## ì‚¬ìš© ë°©ë²•

### ì¼ë°˜ ì‚¬ìš©ì

#### 1. RAG ê²€ìƒ‰í•˜ê¸°
1. ì±—ë´‡ ì—´ê¸°
2. ì§ˆë¬¸ ì…ë ¥ (ì˜ˆ: "íƒˆëª¨ ì¹˜ë£Œ ë°©ë²• ì•Œë ¤ì¤˜")
3. ìë™ìœ¼ë¡œ ê²€ìƒ‰ ê¸°ë¡ ì €ì¥ë¨

#### 2. ë‘í”¼ ì§„ë‹¨í•˜ê¸°
1. ë©”ì¸í˜ì´ì§€ > "ë‘í”¼ ì§„ë‹¨" í´ë¦­
2. ì„¤ë¬¸ ì‘ì„± ë° ì‚¬ì§„ ì—…ë¡œë“œ
3. ë¶„ì„ ì™„ë£Œ ì‹œ ìë™ ì €ì¥ë¨

#### 3. ì œí’ˆ í´ë¦­í•˜ê¸°
1. ì§„ë‹¨ ê²°ê³¼ í˜ì´ì§€ or ì œí’ˆ ëª©ë¡
2. ì œí’ˆ ì¹´ë“œ í´ë¦­
3. ìë™ìœ¼ë¡œ í´ë¦­ ê¸°ë¡ ì €ì¥ë¨

#### 4. ì¼€ì–´ ë¯¸ì…˜ ì™„ë£Œí•˜ê¸°
1. ë°ì¼ë¦¬ ì¼€ì–´ í˜ì´ì§€
2. ë¯¸ì…˜ ì™„ë£Œ ë²„íŠ¼ í´ë¦­
3. ìë™ìœ¼ë¡œ ì™„ë£Œ ê¸°ë¡ ì €ì¥ë¨

### ê´€ë¦¬ì

#### Admin Dashboard ì ‘ê·¼
1. ë¡œê·¸ì¸ (ê´€ë¦¬ì ê³„ì • í•„ìš”)
2. `/admin/dashboard` ì´ë™
3. **UserMetrics** íƒ­ í´ë¦­
4. í†µê³„ í™•ì¸:
   - ì¸ê¸° ê²€ìƒ‰ì–´
   - ì´ ê²€ìƒ‰/ì§„ë‹¨ íšŸìˆ˜
   - í™œì„± ì‚¬ìš©ì ìˆ˜

---

## ì½”ë“œ ì„¤ëª…

### Backend: UserMetricsService.java

#### logRAGSearch() - RAG ê²€ìƒ‰ ì €ì¥
```java
@Transactional
public void logRAGSearch(Long userId, String query,
                         int resultCount, boolean clicked,
                         String clickedTitle) {
    Map<String, Object> data = new HashMap<>();
    data.put("query", query);              // ê²€ìƒ‰ ì¿¼ë¦¬
    data.put("resultCount", resultCount);  // ê²°ê³¼ ê°œìˆ˜
    data.put("clicked", clicked);          // í´ë¦­ ì—¬ë¶€
    data.put("clickedTitle", clickedTitle);// í´ë¦­í•œ ì œëª©
    data.put("timestamp", Instant.now().toString());

    saveMetric(userId, "RAG_SEARCH",
               objectMapper.writeValueAsString(data));
}
```
- **ìš©ë„**: ì±—ë´‡ì—ì„œ ì‚¬ìš©ìê°€ ê²€ìƒ‰í•œ ë‚´ìš© ê¸°ë¡
- **JSON ì €ì¥**: `value` ì»¬ëŸ¼ì— JSON ë¬¸ìì—´ë¡œ ì €ì¥
- **íŠ¸ëœì­ì…˜**: `@Transactional`ë¡œ ì•ˆì „í•˜ê²Œ DB ì €ì¥

#### getPopularSearchKeywords() - ì¸ê¸° ê²€ìƒ‰ì–´
```java
public List<String> getPopularSearchKeywords(int days) {
    List<UserMetricEntity> searches =
        userMetricsRepository.findByTypeOrderByRecordDateDesc("RAG_SEARCH");

    return searches.stream()
        .map(metric -> extractQueryFromValue(metric.getValue()))
        .filter(Objects::nonNull)
        .collect(Collectors.groupingBy(q -> q, Collectors.counting()))
        .entrySet().stream()
        .sorted(Map.Entry.<String, Long>comparingByValue().reversed())
        .limit(10)
        .map(Map.Entry::getKey)
        .collect(Collectors.toList());
}
```
- **ë™ì‘**: RAG_SEARCH íƒ€ì… ë©”íŠ¸ë¦­ì—ì„œ ì¿¼ë¦¬ ì¶”ì¶œ â†’ ë¹ˆë„ìˆ˜ ê³„ì‚° â†’ TOP 10 ë°˜í™˜
- **Stream ì‚¬ìš©**: Java Stream APIë¡œ ê°„ê²°í•˜ê²Œ ì²˜ë¦¬

### Frontend: ChatBotMessenger.tsx

#### sendMessage() - ë©”ì‹œì§€ ì „ì†¡ ë° ë©”íŠ¸ë¦­ ì €ì¥
```typescript
const sendMessage = async (text?: string) => {
  const messageText = text || inputMessage.trim();

  // 1. Python ì±—ë´‡ API í˜¸ì¶œ
  const response = await pythonClient.post('/rag-chat', {
    message: messageText,
    conversation_id: userConversationId,
  });

  const data: ChatResponse = response.data;

  // 2. UserMetricsì— RAG ê²€ìƒ‰ ì €ì¥
  try {
    await apiClient.post('/api/metrics/rag-search', {
      query: messageText,
      resultCount: data.sources?.length || 0,
      clicked: false,
      clickedTitle: ''
    });
  } catch (error) {
    console.log('RAG ê²€ìƒ‰ ë©”íŠ¸ë¦­ ì €ì¥ ì‹¤íŒ¨ (ë¬´ì‹œë¨):', error);
  }

  // 3. AI ê°œì¸í™” ì¶”ì²œ ìš”ì²­
  const recResponse = await apiClient.post(
    '/api/ai/rag-v2-check/chat-with-recommendation',
    { query: messageText, response: data.response }
  );

  // 4. ë©”ì‹œì§€ í‘œì‹œ
  const botMessage: Message = {
    ...
    recommendation: recResponse.data.recommendation
  };
  setMessages(prev => [...prev, botMessage]);
};
```
- **ë¹„ë™ê¸° ì²˜ë¦¬**: `async/await` ì‚¬ìš©
- **ì—ëŸ¬ ë¬´ì‹œ**: ë©”íŠ¸ë¦­ ì €ì¥ ì‹¤íŒ¨í•´ë„ ì‚¬ìš©ì ê²½í—˜ì— ì˜í–¥ ì—†ìŒ
- **ìˆœì„œ**: ì±—ë´‡ ì‘ë‹µ â†’ ë©”íŠ¸ë¦­ ì €ì¥ â†’ AI ì¶”ì²œ

### Frontend: AdminDashboard.tsx

#### UserMetrics íƒ­
```typescript
const fetchMetricsData = async () => {
  setMetricsLoading(true);
  try {
    const [keywordsRes, overviewRes] = await Promise.all([
      apiClient.get<MetricsData>('/admin/metrics/popular-searches?days=7'),
      apiClient.get<MetricsOverview>('/admin/metrics/overview')
    ]);
    setMetricsData(keywordsRes.data);
    setMetricsOverview(overviewRes.data);
  } catch (error) {
    console.error('UserMetrics ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:', error);
  } finally {
    setMetricsLoading(false);
  }
};
```
- **ë³‘ë ¬ ìš”ì²­**: `Promise.all`ë¡œ 2ê°œ API ë™ì‹œ í˜¸ì¶œ (ì„±ëŠ¥ í–¥ìƒ)
- **ë¡œë”© ìƒíƒœ**: `metricsLoading`ìœ¼ë¡œ ìŠ¤í”¼ë„ˆ í‘œì‹œ
- **íƒ€ì… ì•ˆì „**: TypeScript ì¸í„°í˜ì´ìŠ¤ í™œìš©

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ë©”íŠ¸ë¦­ì´ ì €ì¥ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ**: ì‚¬ìš©ìê°€ ê²€ìƒ‰í–ˆëŠ”ë° Admin Dashboardì— ë°ì´í„°ê°€ ì•ˆ ë³´ì„

**ì›ì¸**:
1. ë¡œê·¸ì¸ ì•ˆ í•œ ìƒíƒœ (userIdê°€ null)
2. API ì—”ë“œí¬ì¸íŠ¸ ì˜¤ë¥˜ (404)
3. DB ì—°ê²° ë¬¸ì œ

**í•´ê²°**:
```bash
# 1. ë¡œê·¸ í™•ì¸
# Spring Boot ì½˜ì†”ì—ì„œ "RAG ê²€ìƒ‰ ì €ì¥ ì™„ë£Œ" ë¡œê·¸ í™•ì¸

# 2. Network íƒ­ í™•ì¸
# ë¸Œë¼ìš°ì € ê°œë°œìë„êµ¬ > Network > /api/metrics/rag-search ì‘ë‹µ í™•ì¸

# 3. DB ì§ì ‘ í™•ì¸
SELECT * FROM user_metric WHERE type = 'RAG_SEARCH' ORDER BY record_date DESC LIMIT 10;
```

### ë¬¸ì œ 2: Admin Dashboard í†µê³„ê°€ 0ìœ¼ë¡œ í‘œì‹œ

**ì¦ìƒ**: UserMetrics íƒ­ì—ì„œ ëª¨ë“  ìˆ«ìê°€ 0

**ì›ì¸**:
1. ë°ì´í„°ê°€ ì‹¤ì œë¡œ ì—†ìŒ (ì‚¬ìš©ìê°€ ì•„ì§ í™œë™ ì•ˆ í•¨)
2. Repository ì¿¼ë¦¬ ì˜¤ë¥˜
3. ë‚ ì§œ ë²”ìœ„ ë¬¸ì œ (7ì¼ ì´ìƒ ì§€ë‚œ ë°ì´í„°ë§Œ ìˆìŒ)

**í•´ê²°**:
```java
// UserMetricsService.javaì—ì„œ ë””ë²„ê¹…
public long getTotalSearchCount() {
    long count = userMetricsRepository
        .findByTypeOrderByRecordDateDesc("RAG_SEARCH").size();
    log.info("ì´ ê²€ìƒ‰ íšŸìˆ˜: {}", count);  // ë¡œê·¸ ì¶”ê°€
    return count;
}
```

### ë¬¸ì œ 3: JSON íŒŒì‹± ì—ëŸ¬

**ì¦ìƒ**: `value` ì»¬ëŸ¼ ë°ì´í„°ë¥¼ ì½ì„ ë•Œ ì—ëŸ¬

**ì›ì¸**: JSON í˜•ì‹ì´ ì˜ëª»ë¨

**í•´ê²°**:
```java
private String extractQueryFromValue(String value) {
    try {
        Map<String, Object> data = objectMapper.readValue(value, Map.class);
        return (String) data.get("query");
    } catch (Exception e) {
        log.error("JSON íŒŒì‹± ì‹¤íŒ¨: {}", value, e);
        return null;  // null ë°˜í™˜ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
    }
}
```

---

## API ì—”ë“œí¬ì¸íŠ¸ ìš”ì•½

### ì‚¬ìš©ììš© API

| Method | URL | ì„¤ëª… | Body |
|--------|-----|------|------|
| POST | `/api/metrics/rag-search` | RAG ê²€ìƒ‰ ì €ì¥ | `{query, resultCount, clicked, clickedTitle}` |
| POST | `/api/metrics/scalp-diagnosis` | ë‘í”¼ ì§„ë‹¨ ì €ì¥ | `{scalpType, scalpScore, sensitivity}` |
| POST | `/api/metrics/product-click` | ì œí’ˆ í´ë¦­ ì €ì¥ | `{productCategory, productName, recommendedBy}` |
| POST | `/api/metrics/care-mission` | ì¼€ì–´ ë¯¸ì…˜ ì €ì¥ | `{missionType, streakCount}` |
| GET | `/api/metrics/my-summary` | ë‚´ ë©”íŠ¸ë¦­ ìš”ì•½ | - |

### ê´€ë¦¬ììš© API

| Method | URL | ì„¤ëª… | Query Params |
|--------|-----|------|--------------|
| GET | `/api/admin/metrics/popular-searches` | ì¸ê¸° ê²€ìƒ‰ì–´ TOP 10 | `days=7` |
| GET | `/api/admin/metrics/overview` | ì „ì²´ í†µê³„ | - |

---

## í–¥í›„ í™•ì¥ ê°€ëŠ¥ ê¸°ëŠ¥

### 1. í˜ì´ì§€ ì²´ë¥˜ ì‹œê°„ ì¶”ì 
```typescript
// ì˜ˆì‹œ ì½”ë“œ
useEffect(() => {
  const startTime = Date.now();
  return () => {
    const duration = Math.floor((Date.now() - startTime) / 1000);
    apiClient.post('/api/metrics/page-dwell-time', {
      page: window.location.pathname,
      duration
    });
  };
}, []);
```

### 2. AI ì¶”ì²œ ìƒì„± íšŸìˆ˜ ì¶”ì 
- ì±—ë´‡ì—ì„œ AI ì¶”ì²œì´ ìƒì„±ë  ë•Œë§ˆë‹¤ ì¹´ìš´íŠ¸
- Admin Dashboardì—ì„œ ì‹œê°í™”

### 3. ì‚¬ìš©ìë³„ ìƒì„¸ ë¶„ì„
- íŠ¹ì • ì‚¬ìš©ìì˜ í–‰ë™ íŒ¨í„´ ë¶„ì„
- `/admin/user/{userId}/metrics` í˜ì´ì§€

### 4. ì‹¤ì‹œê°„ ì°¨íŠ¸
- Chart.js ë˜ëŠ” Recharts ì‚¬ìš©
- ì¼ë³„/ì£¼ë³„ íŠ¸ë Œë“œ ì‹œê°í™”

---

## ì°¸ê³  ìë£Œ

### íŒŒì¼ ìœ„ì¹˜

**Backend**:
- Entity: `backend/springboot/src/main/java/com/example/springboot/UserMetricEntity.java`
- Repository: `backend/springboot/src/main/java/com/example/springboot/data/repository/UserMetricsRepository.java`
- Service: `backend/springboot/src/main/java/com/example/springboot/service/metrics/UserMetricsService.java`
- Controller: `backend/springboot/src/main/java/com/example/springboot/controller/metrics/UserMetricsController.java`
- Admin Controller: `backend/springboot/src/main/java/com/example/springboot/controller/admin/AdminController.java`

**Frontend**:
- ChatBot: `frontend/src/pages/ChatBot/ChatBotMessenger.tsx`
- ì§„ë‹¨: `frontend/src/pages/check/IntegratedDiagnosis.tsx`
- ì œí’ˆ: `frontend/src/pages/hair_product/ProductCard.tsx`
- ì¼€ì–´: `frontend/src/pages/hair_dailycare/DailyCare.tsx`
- Admin: `frontend/src/pages/admin/AdminDashboard.tsx`

### ì˜ì¡´ì„±

**Spring Boot**:
```xml
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
</dependency>
```

**React**:
```json
{
  "axios": "^1.x.x",
  "react": "^18.x.x",
  "lucide-react": "^0.x.x"
}
```

---

## ë§ˆë¬´ë¦¬

ì´ ì‹œìŠ¤í…œì€ **ì‚¬ìš©ì í–‰ë™ì„ ì¶”ì í•˜ì—¬ AI ê°œì¸í™” ì¶”ì²œì˜ ì •í™•ë„ë¥¼ ë†’ì´ëŠ”** í•µì‹¬ ì¸í”„ë¼ì…ë‹ˆë‹¤.

- âœ… ìë™ ìˆ˜ì§‘: ì‚¬ìš©ìê°€ ì˜ì‹í•˜ì§€ ëª»í•˜ê²Œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìˆ˜ì§‘
- âœ… í™•ì¥ ê°€ëŠ¥: ìƒˆë¡œìš´ ë©”íŠ¸ë¦­ íƒ€ì… ì‰½ê²Œ ì¶”ê°€ ê°€ëŠ¥
- âœ… ì•ˆì „: ì—ëŸ¬ ë°œìƒí•´ë„ ì‚¬ìš©ì ê²½í—˜ì— ì˜í–¥ ì—†ìŒ
- âœ… ê´€ë¦¬ í¸ë¦¬: Admin Dashboardì—ì„œ í•œëˆˆì— í™•ì¸

**ì§ˆë¬¸ì´ë‚˜ ë¬¸ì œê°€ ìˆìœ¼ë©´ ì´ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì„¸ìš”!** ğŸš€
